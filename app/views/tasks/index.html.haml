:javascript
 $(document).ready( function() {
    var oTable = $('#taskTable').dataTable( {
        "fnDrawCallback":function(){ $('.datepicker').datepicker()},
        "aaSorting": [[ 3, "desc" ], [ 0, "desc" ]]
    });
    $('#addNewButton').click(function() {
    fnClickAddRow();
  })


 oTable.$('td').editable(function(value, settings) {

   var aPos = oTable.fnGetPosition(this); //gets xy position in table
   var name = $('#taskTable thead tr th:eq(' + aPos[1] + ')').attr('id'); //column name is the id
   var id = this.parentNode.getAttribute('id');  //row id (also in column 0)

   var data = {};
   data[name] = value;

   var taskdata = {task : data};

   $.ajax({
       type: 'PUT',
       url: 'tasks/' + id + '.json',
       data : taskdata,
   });

       oTable.fnUpdate(value, aPos[0], aPos[1], true );
       return(value);

    }, {
         type    : 'textarea',
         submit  : 'OK',
        "height": "14px",
        "width": "100%"

      });

 });

 function fnClickAddRow() {

     var d = new Date();

    //var lastRow = $('#taskTable').dataTable().fnGetData(0); //get data from row 0
    var i =  $('#taskTable tbody tr:first')[0];
    //var i =  $('#taskTable');
    var lastRow = $('#taskTable').dataTable().fnGetData(i); //get data from row 0
    if (lastRow == null) {
        lastRow = new Array();
        lastRow[1] = "";
        lastRow[2] = "";
        lastRow[3] = "";
        lastRow[4] = "";
    }




      var testdata = {task : {"project_name" : lastRow[1], "task_name" : lastRow[2], "performed_on": d.toISOString(), "hours" : lastRow[4], "notes" : lastRow[5]}};

      $.ajax({
          type: 'POST',
          url: 'tasks.json',
          data : testdata,
      });

      window.location.reload(true);  //heavy-handed, but otherwise it's a big pain in the arse to get new row editable

  }

 $(function() {
  $( "#datepicker" ).datepicker();
 });

.page-header
 %h1 #{@user.name}'s Completed Tasks


.row.span12
 %button.btn.btn-primary#addNewButton Add New Task
 <p>Date: <input type="text" id="datepicker"></p>

.row.span12

 %table.table.table-striped.table-bordered.table-condensed#taskTable
  %thead
   %tr
    %th.hidden Task Id
    %th{:id=>"project_name"} Project name
    %th{:id=>"task_name"} Task name
    %th{:id=>"performed_on"} Completed on
    %th{:id=>"hours"} Hours
    %th{:id=>"notes"} Notes
    %th
  %tbody
   - @tasks.each do |task|
    %tr{:id=>task.id}
     %td.hidden= task.id
     %td= task.project_name
     %td= task.task_name
     %td.datepicker= task.performed_on
     %td= task.hours
     %td= task.notes
     %td= link_to 'Delete', task, confirm: 'Are you sure?', method: :delete


.result
